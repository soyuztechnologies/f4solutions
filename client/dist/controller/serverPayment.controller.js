sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter","sap/ui/model/Filter"],function(e,t,i,s,a){"use strict";return e.extend("oft.fiori.controller.serverPayment",{formatter:s,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);var e=this;e.getView().setBusy(true);var t=this.getModel("local").getProperty("/CurrentUser");if(t){var i=this.getModel("local").oData.AppUsers[t].UserName}i="Hey "+i;this.getView().byId("idUser").setText(i);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Students","GET",null,null,this).then(function(t){e.getView().setBusy(false)}).catch(function(t){var i=e.getErrorMessage(t)});e.getView().setBusy(true);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/ServerPays","GET",null,null,this).then(function(t){e.getView().setBusy(false)}).catch(function(t){var i=e.getErrorMessage(t)})},onBack:function(){sap.ui.getCore().byId("idApp").to("idView1")},onItemSelect:function(e){var t=e.getParameter("listItem").getBindingContextPath();var i=t.split("/")[t.split("/").length-1];this.oRouter.navTo("detail2",{suppId:i})},onPress:function(){sap.m.MessageBox.alert("Button was clicked")},onHover:function(){sap.m.MessageBox.alert("Button was Hovered")},herculis:function(e){if(e.getParameter("name")!=="serverPayment"){return}this.getView().byId("serTable").getBinding("items").refresh(true);this.getView().getModel("local").setProperty("/newServerPay/PaymentDate",this.formatter.getFormattedDate(0))},supplierPopup:null,oInp:null,onPopupConfirm:function(e){var t=e.getParameter("selectedItem");this.oInp.setValue(t.getLabel())},oSuppPopup:null,onFilter:function(){if(!this.oSuppPopup){this.oSuppPopup=new sap.ui.xmlfragment("oft.fiori.fragments.popup",this);this.getView().addDependent(this.oSuppPopup);this.oSuppPopup.setTitle("Suppliers");this.oSuppPopup.bindAggregation("items",{path:"/suppliers",template:new sap.m.DisplayListItem({label:"{name}",value:"{city}"})})}this.oSuppPopup.open()},onRequest:function(e){this.oInp=e.getSource();if(!this.supplierPopup){this.supplierPopup=new sap.ui.xmlfragment("oft.fiori.fragments.popup",this);this.supplierPopup.setTitle("Cities");this.getView().addDependent(this.supplierPopup);this.supplierPopup.bindAggregation("items",{path:"/cities",template:new sap.m.DisplayListItem({label:"{cityName}",value:"{famousFor}"})})}this.supplierPopup.open()},onConfirm:function(e){var t=this.getSelectedKey(e);this.getView().byId("customerId").setValue(t[0]);this.getView().byId("name").setText(t[1]);this.getView().byId("cid").setValue(t[2])},onStudenIdChange:function(e){var t=e.getSource().oPropagatedProperties.oBindingContexts.undefined.sPath;t=t.split("/")[1];var i=this.getView().getModel().oData[t].StudentId;i="Students('"+i+"')";var s=this.getView().getModel().oData[i];if(s){var a=s.GmailId;e.getSource().setText(a)}},onSave:function(e){var t=e;console.log(this.getView().getModel("local").getProperty("/newServerPay"));var i=this;i.getView().setBusy(true);var s=this.getView().getModel("local").getProperty("/newServerPay");if(!this.getView().byId("payDate").getDateValue()){sap.m.MessageToast.show("Enter a valid Date");return""}var a={Type:this.getView().byId("idRBG").getSelectedButton().mProperties.text,StudentId:this.getView().byId("cid").getValue(),Amount:this.getView().byId("amount").getValue(),PaymentDate:this.getView().byId("payDate").getDateValue(),Remarks:this.getView().byId("Remarks").getValue(),Update:"C"};this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/ServerPays","POST",{},a,i).then(function(e){i.getView().setBusy(false);sap.m.MessageToast.show("Server Payment Saved successfully");if(i.getView().byId("serTable").getBinding("items")){i.getView().byId("serTable").getBinding("items").refresh(true)}}).catch(function(e){i.getView().setBusy(false);var t=i.getErrorMessage(e)})},onSearch:function(e){var t=this.getQuery(e);if(t){var i=new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter("GmailId",sap.ui.model.FilterOperator.Contains,t);var a=new sap.ui.model.Filter({filters:[i,s],and:false});var o=[a];this.searchPopup.getBinding("items").filter(o)}else{this.searchPopup.bindAggregation("items",{path:"/Students",template:new sap.m.DisplayListItem({label:"{Name}",value:"{GmailId}"})});this.searchPopup.getBinding("items").filter([])}},onSelect:function(){this.getCustomerPopup();var e=this.getView().getModel("i18n").getProperty("customer");this.searchPopup.setTitle(e);this.searchPopup.bindAggregation("items",{path:"/Students",template:new sap.m.DisplayListItem({label:"{Name}",value:"{GmailId}"})})},radiobuttonselect:function(e){var t=e.getParameters().selectedIndex;if(t==1){this.getView().byId("customerId").setEnabled(true)}else{this.getView().byId("customerId").setEnabled(false);this.getView().byId("customerId").setValue(null);this.getView().byId("cid").setValue(null);this.getView().byId("name").setText(null)}},onDelete:function(e){var i=this;t.confirm("Do you want to delete the selected records?",function(e){if(e=="OK"){var t=i.getView().byId("serTable").getSelectedContexts();for(var s=0;s<t["length"];s++){i.ODataHelper.callOData(i.getOwnerComponent().getModel(),t[s].sPath,"DELETE",{},{},i).then(function(e){sap.m.MessageToast.show("Deleted succesfully")}).catch(function(e){i.getView().setBusy(false);i.oPopover=i.getErrorMessage(e);i.getView().setBusy(false)})}}},"Confirmation")},onDataExport:function(e){$.ajax({type:"GET",url:"ServerPayDownload",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,i){sap.m.MessageToast.show("error in downloading the excel file")}})},onApprove:function(){t.confirm("Do you want to approve this fruit",{title:"confirmation",onClose:this.onConfirm.bind(this)})}})});