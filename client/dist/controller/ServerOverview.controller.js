sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter","sap/ui/model/Filter"],function(e,t,r,i,a){"use strict";return e.extend("oft.fiori.controller.ServerOverview",{formatter:i,count:0,countAct:0,countInAct:0,countExp:0,date:new Date,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);var e=this.getModel("local").getProperty("/CurrentUser");if(e){var t=this.getModel("local").oData.AppUsers[e].UserName}t="Hey "+t;this.getView().byId("idUser").setText(t);var r=this;r.getView().setBusy(true);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Students","GET",null,null,this).then(function(e){r.getView().setBusy(false)}).catch(function(e){var t=r.getErrorMessage(e)});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Servers","GET",null,null,this).then(function(e){r.getView().setBusy(false);r.count=e.results.length}).catch(function(e){var t=r.getErrorMessage(e)})},onStudenIdChange:function(e){var t=e.getSource().oPropagatedProperties.oBindingContexts.undefined.sPath;t=t.split("/")[1];var r=this.getView().getModel().oData[t].StudentId;r="Students('"+r+"')";var i=this.getView().getModel().oData[r];if(i){var a=i.GmailId;e.getSource().setText(a)}},handleIconTabBarSelect:function(e){var t=e.getSource().getSelectedKey();var r=new Date;switch(t){case"All":this.getView().byId("serverOvrTable").getBinding("items").filter([]);break;case"Ok":this.getView().byId("serverOvrTable").getBinding("items").filter([]);var i=new sap.ui.model.Filter("EndDate","GT",r);var a=new sap.ui.model.Filter("UserEndDate","GT",r);var s=new sap.ui.model.Filter({filters:[i,a],and:true});this.getView().byId("serverOvrTable").getBinding("items").filter([s]);break;case"Inactive":this.getView().byId("serverOvrTable").getBinding("items").filter([]);var i=new sap.ui.model.Filter("EndDate","GT",r);var a=new sap.ui.model.Filter("UserEndDate","LT",r);var n=new sap.ui.model.Filter({filters:[i,a],and:true});this.getView().byId("serverOvrTable").getBinding("items").filter([n]);break;case"Expired":this.getView().byId("serverOvrTable").getBinding("items").filter([]);var i=new sap.ui.model.Filter("EndDate","LT",r);var a=new sap.ui.model.Filter("UserEndDate","LT",r);var o=new sap.ui.model.Filter({filters:[i,a],and:true});this.getView().byId("serverOvrTable").getBinding("items").filter([o]);break}},onUpdateFinished:function(e){var t=this.getView().byId("serverOvrTable");if(t.getBinding("items").isLengthFinal()){var r=this.getView().byId("idAll");r.setCount(this.count)}},herculis:function(e){if(e.getParameter("name")!=="ServerOverview"){return}var t=this;var r=new sap.ui.model.Filter("EndDate","GT",this.date);var i=new sap.ui.model.Filter("UserEndDate","GT",this.date);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Servers/count","GET",{filters:[r,i],and:true},null,this).then(function(e){var r=e.results.length;var i=t.getView().byId("idActive");i.setCount(r)}).catch(function(e){});var a=new sap.ui.model.Filter("EndDate","GT",this.date);var s=new sap.ui.model.Filter("UserEndDate","LT",this.date);var n=new sap.ui.model.Filter({filters:[a,s],and:true});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Servers/count","GET",{filters:[n]},null,this).then(function(e){var r=e.results.length;var i=t.getView().byId("idInActive");i.setCount(r)}).catch(function(e){});var o=new sap.ui.model.Filter("EndDate","LT",this.date);var l=new sap.ui.model.Filter("UserEndDate","LT",this.date);var d=new sap.ui.model.Filter({filters:[o,l],and:true});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Servers/count","GET",{filters:[d]},null,this).then(function(e){var r=e.results.length;var i=t.getView().byId("idExpired");i.setCount(r)}).catch(function(e){})},onDataExport:function(e){var t=this.getView().byId("idIconTabBarSerOvr").getSelectedKey();if(t=="All"){$.ajax({type:"GET",url:"ServerDownload",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,r){sap.m.MessageToast.show("error in downloading the excel file")}})}else if(t=="Ok"){$.ajax({type:"GET",url:"ServerDownloadAct",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,r){sap.m.MessageToast.show("error in downloading the excel file")}})}else if(t=="Inactive"){$.ajax({type:"GET",url:"ServerDownloadInAct",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,r){sap.m.MessageToast.show("error in downloading the excel file")}})}else{$.ajax({type:"GET",url:"ServerDownloadExp",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,r){sap.m.MessageToast.show("error in downloading the excel file")}})}}})});