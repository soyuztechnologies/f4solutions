sap.ui.define(["oft/fiori/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","oft/fiori/models/ChartFormatter"],function(e,t,i,a,r){"use strict";return e.extend("oft.fiori.controller.analytical",{_oJSONModel:null,_oJSONModel1:null,_oJSONModel2:null,_oVizFrame1:null,_oVizFrame2:null,_oVizFrame3:null,_VizFrame:null,_oZone_Storage:null,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this._onWorkListMatched,this);var e=this.getModel("local").getProperty("/CurrentUser");var t=this.getModel("local").oData.AppUsers[e].UserName;this.getView().byId("idUser").setText(t);var i=r.DefaultPattern;var a=this.oVizFrame=this.getView().byId("idVizFrame1");var s=this.oVizFrame=this.getView().byId("idVizFrame2");var o=this.oVizFrame=this.getView().byId("idVizFrame3");var n=this.oVizFrame=this.getView().byId("idVizFrame4");this._setChartProperties(a,"Students Per Batch");this._setChartProperties(s,"Batches Per Course");this._setChartProperties(o,"Students Per Course");this._setChartProperties(n,"Students For Last 5 Months");this._initPageSettings(this.getView(),"idVizFrame1","Cell1");this._initPageSettings(this.getView(),"idVizFrame2","Cell2");this._initPageSettings(this.getView(),"idVizFrame3","Cell3");this._initPageSettings(this.getView(),"idVizFrame4","Cell4")},_initPageSettings:function(e,t,i){if(sap.ui.Device.system.phone){var a=e.byId("settingsPanel");if(a){a.setExpanded(false)}}var r=sap.ui.getVersionInfo().libraries||[];var s=r.some(function(e){return e.name.indexOf("sap.suite.ui.commons")>-1});if(s){jQuery.sap.require("sap/suite/ui/commons/ChartContainer");var o=e.byId(t);var n=new sap.suite.ui.commons.ChartContainerContent({icon:"sap-icon://horizontal-bar-chart",title:"vizFrame Bar Chart Sample",content:[o]});var l=new sap.suite.ui.commons.ChartContainer({content:[n]});l.setShowFullScreen(true);l.setAutoAdjustHeight(true);e.byId(i).addContent(l)}},_setChartProperties:function(e,t){e.setVizProperties({plotArea:{dataLabel:{visible:true}},valueAxis:{label:{},title:{visible:true}},categoryAxis:{title:{visible:true}},title:{visible:true,text:t}})},_onWorkListMatched:function(e){if(e.getParameter("name")!=="analytical"){return}var i=this;$.get("/getStudentPerBatch").done(function(e,a){var r=new t;r.setData({BarData:e});i.getView().setModel(r,"BarChartModel")}).fail(function(e,t,i){sap.m.MessageBox.error("Error in access")});$.get("/getBatchPerCourse").done(function(e,a){var r=new t;r.setData({PieData:e});i.getView().setModel(r,"PieChartModel")}).fail(function(e,t,i){sap.m.MessageBox.error("Error in access")});$.get("/getStudentPerCourse").done(function(e,a){var r=new t;r.setData({PieData:e});i.getView().setModel(r,"Pie2ChartModel")}).fail(function(e,t,i){sap.m.MessageBox.error("Error in access")});$.get("/getCountLastMonths").done(function(e,a){var r=new t;r.setData({LineData:e});i.getView().setModel(r,"LineChartModel")}).fail(function(e,t,i){sap.m.MessageBox.error("Error in access")})},_totalChart:function(){this._loadModelData();this._initialChart()},_initialChart:function(){var e=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:"Gmail",value:"{GmailId}"}],measures:[{name:"Contact No",value:"{ContactNo}"}],data:{path:"/Students"}});this._oVizFrame.setDataset(e);this._oVizFrame.setVizType("bar");this._oVizFrame.setVizProperties({plotArea:{colorPalette:d3.scale.category20().range()}});var t=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"valueAxis",type:"Measure",values:["Contact No"]}),i=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"categoryAxis",type:"Dimension",values:["Gmail"]});this._oVizFrame.removeAllFeeds();this._oVizFrame.addFeed(t);this._oVizFrame.addFeed(i)},_loadModelData:function(){debugger;var e=this.getView().getModel();var i="/Students";this._oJSONModel=new t;this._oVizFrame.setBusy(true);e.read(i,{success:function(e){debugger;this._oVizFrame.setBusy(false);this._oJSONModel=this._oVizFrame.getModel();this._oJSONModel.setData(e);this._oVizFrame.setModel(this._oJSONModel)}.bind(this),error:function(){debugger;this._oVizFrame.setBusy(false)}})}})});