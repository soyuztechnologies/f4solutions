var oGuid;sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter"],function(e,t,a,i){"use strict";return e.extend("oft.fiori.controller.batch",{formatter:i,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);var e=this.getModel("local").getProperty("/CurrentUser");var t=this.getModel("local").oData.AppUsers[e].UserName;t="Hey "+t;this.getView().byId("idUser").setText(t)},onBack:function(){sap.ui.getCore().byId("idApp").to("idView1")},onSave:function(e){console.log(this.getView().getModel("local").getProperty("/newBatch"));var t=e;var a=this;var i=this.getView().getModel("local").getProperty("/newBatch");a.getView().setBusy(true);var s={BatchNo:i.courseId,Name:i.courseName,DemoStartDate:this.getView().byId("idDemoDate").getDateValue(),StartDate:this.getView().byId("idStartDate").getDateValue(),EndDate:this.getView().byId("idEndDate").getDateValue(),BlogEndDate:this.getView().byId("idBlogEnd").getDateValue(),Link:i.link,Weekend:i.weekend,hidden:String(i.hidden),Timings:i.Timings,Fee:i.courseFee,CreatedOn:new Date,CalendarId:i.CalendarId,EventId:i.EventId,DriveId:i.DriveId,status:i.status,analysis:i.analysis};if(this.flag==="batchid"){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Courses('"+oGuid+"')","PUT",{},s,this).then(function(e){a.getView().setBusy(false);sap.m.MessageToast.show("Course Updated successfully");a.destroyMessagePopover()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Courses","POST",{},s,this).then(function(e){a.getView().setBusy(false);sap.m.MessageToast.show("New Course Saved successfully");a.destroyMessagePopover()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}},onReplicateBatches:function(){var e=this;t.confirm("are you sure?",function(i){if(i==="OK"){e.getView().byId("idReplicateBatches").setEnabled(false);a.show("Replication started, Please Wait...");$.get("/replicateBatchesToStudentPortal").done(function(a,i){t.success(JSON.stringify(a));e.getView().byId("idReplicateBatches").setEnabled(true)}).fail(function(a,i,s){e.getView().byId("idReplicateBatches").setEnabled(true);t.error("Error in access")})}})},onReplicateOneBatch:function(){var e=this;const i=this.getView().byId("idCourseId").getValue();const s=this.getView().byId("batch").getValue();var r={Name:s,BatchNo:i};if(i&&s){t.confirm("are you sure?",function(i){if(i==="OK"){e.getView().byId("idReplicateBatches").setEnabled(false);a.show("Replication started, Please Wait...");$.post("/replicateOneBatchToStudentPortal",r).done(function(a,i){t.success(JSON.stringify(a));e.getView().byId("idReplicateBatches").setEnabled(true)}).fail(function(a,i,s){e.getView().byId("idReplicateBatches").setEnabled(true);t.error("Error in access")})}})}else{a.show("Please select a batch")}},onStartChange:function(e){var t=e.getSource().getValue();var a=t.split(".");var i=new Date(a[2],a[1]-1,a[0]);var s=this.formatter.getIncrementDate(i,2.5);this.getView().getModel("local").setProperty("/newBatch/endDate",s);i=new Date(a[2],a[1]-1,a[0]);var r=this.formatter.getIncrementDate(i,8);this.getView().getModel("local").setProperty("/newBatch/blogDate",r);console.log(s);console.log(r)},herculis:function(e){if(e.getParameter("name")!=="batch"){return}this.getView().getModel("local").setProperty("/newBatch/startDate",this.formatter.getFormattedDate(0));this.getView().getModel("local").setProperty("/newBatch/demoStartDate",this.formatter.getFormattedDate(0));this.getView().getModel("local").setProperty("/newBatch/endDate",this.formatter.getFormattedDate(2.5));this.getView().getModel("local").setProperty("/newBatch/blogDate",this.formatter.getFormattedDate(8))},onChange:function(){debugger;alert("HELLOOO")},onSelect:function(){this.flag="courseName";this.getCustomerPopup();var e=this.getView().getModel("i18n").getProperty("course");this.searchPopup.setTitle(e);this.searchPopup.bindAggregation("items",{path:"local>/courses",template:new sap.m.DisplayListItem({label:"{local>courseName}"})})},onConfirm:function(e){if(this.flag==="courseName"){var t=e.getParameter("selectedItem").getLabel();this.getView().getModel("local").setProperty("/newBatch/courseName",t)}if(this.flag==="batchid"){var a=this.getSelectedKey(e);this.getView().byId("idCourseId").setValue(a[0]);var i="Courses('"+a[2]+"')";var s=this.getView().getModel().oData[i];var r=this;if(s){var o=s.Name;var l=this.getView().byId("batch");l.setValue(o);var d=this.onDateFormatted(s.DemoStartDate);var n=this.getView().byId("idDemoDate");n.setValue(d);var c=this.onDateFormatted(s.StartDate);var g=this.getView().byId("idStartDate");g.setValue(c);var h=this.onDateFormatted(s.EndDate);var u=this.getView().byId("idEndDate");u.setValue(h);var V=this.onDateFormatted(s.BlogEndDate);var w=this.getView().byId("idBlogEnd");w.setValue(V);var f=s.Fee;var p=this.getView().byId("idFee");p.setValue(f);var y=s.Link;var m=this.getView().byId("idLink");m.setValue(y);var v=s.Timings;var b=this.getView().byId("idTiming");b.setValue(v);oGuid=s.id;var I=s.Weekend;if(I===true){var D=this.getView().byId("idWeekend").setSelected(true)}else{var D=this.getView().byId("idWeekend").setSelected(false)}var B=s.hidden;var P;if(B===true){P=this.getView().byId("idChkBtcHid").setSelected(true)}else{P=this.getView().byId("idChkBtcHid").setSelected(false)}var C=s.analysis;if(C===true){var S=this.getView().byId("idAnalysis").setSelected(true)}else{var S=this.getView().byId("idAnalysis").setSelected(false)}this.getView().byId("idCalId").setValue(s.CalendarId);this.getView().byId("idEvent").setValue(s.EventId);this.getView().byId("idDrive").setValue(s.DriveId);this.getView().byId("idStatus").setValue(s.status)}}},onClearScreen:function(){this.getView().byId("idCourseId").setValue("");this.getView().byId("batch").setValue("");this.getView().byId("idLink").setValue("");this.getView().byId("idTiming").setValue("");this.getView().byId("idCalId").setValue("");this.getView().byId("idEvent").setValue("");this.getView().byId("idDrive").setValue("");this.getView().byId("idStatus").setValue("");this.getView().byId("idAnalysis").setValue("")},onBatchSelect:function(){this.flag="batchid";this.getCustomerPopup();var e=this.getView().getModel("i18n").getProperty("batch");this.searchPopup.setTitle(e);this.searchPopup.bindAggregation("items",{path:"/Courses",template:new sap.m.DisplayListItem({label:"{Name}",value:"{BatchNo}"})})},onLiveSearch:function(e){var t=e.getParameter("query");if(!t){t=e.getParameter("value")}if(t){var a=new sap.ui.model.Filter("courseName",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter({filters:[a],and:false});var s=[i];this.searchPopup.getBinding("items").filter(s)}else{this.searchPopup.bindAggregation("items",{path:"local>/courses",template:new sap.m.DisplayListItem({label:"{local>courseName}"})});this.searchPopup.getBinding("items").filter([])}}})});